name: Update RSS Feed

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: pages
  cancel-in-progress: true

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install hf CLI
        run: curl -LsSf https://hf.co/cli/install.sh | bash

      - name: Scrape via HF Jobs
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          mkdir -p _site
          hf jobs uv run main.py -- --rss - > _site/feed.xml
          cat _site/feed.xml

      - name: Generate index.html
        run: |
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head><meta charset="utf-8"><title>Trading Economics Summary</title></head>
          <body>
          <h1>Trading Economics Summary</h1>
          <p>Subscribe to the <a href="feed.xml">RSS feed</a> for hourly updates.</p>
          </body>
          </html>
          EOF

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site
          force_orphan: true
